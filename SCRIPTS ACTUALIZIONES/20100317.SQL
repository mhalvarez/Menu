

ALTER TABLE INTEGRACION.TH_HOTEL
 ADD (TEMPORAL  VARCHAR2(10));


UPDATE TH_HOTEL SET TEMPORAL = HOTEL_ESTABLECIMIENTO_NEWCONTA ;
COMMIT;


ALTER TABLE INTEGRACION.TH_HOTEL
MODIFY(HOTEL_ESTABLECIMIENTO_NEWCONTA  NULL);



UPDATE TH_HOTEL SET HOTEL_ESTABLECIMIENTO_NEWCONTA  = NULL;
COMMIT;

ALTER TABLE INTEGRACION.TH_HOTEL
MODIFY(HOTEL_ESTABLECIMIENTO_NEWCONTA VARCHAR2(10));

ALTER TABLE INTEGRACION.TH_HOTEL
MODIFY(HOTEL_ESTABLECIMIENTO_NEWCONTA  DEFAULT '0');

UPDATE TH_HOTEL SET HOTEL_ESTABLECIMIENTO_NEWCONTA  =  TEMPORAL;
COMMIT;

ALTER TABLE INTEGRACION.TH_HOTEL DROP COLUMN TEMPORAL;


----


CREATE TABLE TH_INCI
(
  INCI_DATR          DATE                       NOT NULL,
  INCI_EMPGRUPO_COD  VARCHAR2(4 BYTE)           NOT NULL,
  INCI_EMP_COD       VARCHAR2(4 BYTE)           NOT NULL,
  INCI_EMP_NUM       NUMBER                     NOT NULL,
  INCI_LINE          NUMBER                     DEFAULT 0                     NOT NULL,
  INCI_ORIGEN        VARCHAR2(100 BYTE),
  INCI_DESCRIPCION   VARCHAR2(4000 BYTE)
)
LOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING;

COMMENT ON TABLE TH_INCI IS 'Gestion de Incidencias';

COMMENT ON COLUMN TH_INCI.INCI_LINE IS 'Para key Principal';

COMMENT ON COLUMN TH_INCI.INCI_ORIGEN IS 'Aplicacion que genero la Incidencia Newhotel , NewStock ...';

COMMENT ON COLUMN TH_INCI.INCI_DESCRIPCION IS 'Descripcion de la Incidencia';


CREATE UNIQUE INDEX TH_INCI_PK ON TH_INCI
(INCI_DATR, INCI_EMPGRUPO_COD, INCI_EMP_COD, INCI_EMP_NUM, INCI_LINE)
LOGGING
NOPARALLEL;


CREATE OR REPLACE TRIGGER TH_INCI_TRG1 BEFORE INSERT ON "TH_INCI" FOR EACH ROW
DECLARE CODIGO NUMBER;

BEGIN
  LOCK TABLE TH_INCI IN EXCLUSIVE MODE;

  SELECT NVL(MAX(INCI_LINE),'0') + 1
  INTO CODIGO
  FROM TH_INCI;

  IF(INSERTING) THEN
    :NEW.INCI_LINE := CODIGO;
  END IF;

EXCEPTION
WHEN OTHERS THEN
  -- CONSIDER LOGGING THE ERROR AND THEN RE-RAISE
  RAISE;

END TH_INCI_TRG1;
/


ALTER TABLE TH_INCI ADD (
  CONSTRAINT TH_INCI_PK
 PRIMARY KEY
 (INCI_DATR, INCI_EMPGRUPO_COD, INCI_EMP_COD, INCI_EMP_NUM, INCI_LINE));





UPDATE TH_PARA SET PARA_FECHA_BASE = '17-MAR-2010';
UPDATE TH_PARA SET PARA_FECHA_EXE  = '17-MAR-2010';

COMMIT;

 